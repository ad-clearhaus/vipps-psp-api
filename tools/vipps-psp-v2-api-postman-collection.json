{
	"info": {
		"_postman_id": "0c05b450-dc35-4e62-811e-8cbae1d51469",
		"name": "PSP API v2 - Collection",
		"description": "\nVipps PSP API gives the PSP the ability to process Vipps payment as a part  of their payment offerings. By using PSP API, PSP’s still have full\n transactional  control for payments initiated in their payment terminals. VVipps PSP API allows  PSP’s to initiate payments for end users to accept with the Vipps mobile app.  After customer confirms the payment, Vipps enrich payment  data with encrypted  credit card details and hand over payment processing to the PSP\n\n# Idempotency\nAll API requests in Vipps eCommerce can be retried without any side effects by providing idempotent key in a header of  the request. For example, in case the request fails because of network error it can safely be retried with the same idempotent key. Idempotent key is generated by merchant.\n\n  ```\n  Request-Id: slvnwdcweofjwefweklfwelf\n  ```\n\n# Authentication\nEvery API call is authenticated and authorized based on the application Authorization token (JWT) and APIM subscription key (`Ocp-Apim-Subscription-Key`). Following headers are required to be there in every API request to successfully authenticate every API call.\n\n  | **Header Name** | **Header Value** | **Description** |\n  | :-------------------------- | :--------------------------- | :--------------------------------------------- |\n  | Authorization | Bearer 'jwt_access_token'' | type: Authorization token<br>Value: Access token is obtained from accessToken/get |\n  | Ocp-Apim-Subscription-Key | Base 64 encoded string | Subscription key for the product.<br>Can be found in Vipps developer portal |\n",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Get Access Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "e82847b6-91eb-4ce3-9fb5-8198d399ff0a",
						"exec": [
							"pm.environment.set(\"access_token\", pm.response.json().access_token);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "client_id",
						"value": "{{client_id}}"
					},
					{
						"key": "client_secret",
						"value": "{{client_secret}}"
					},
					{
						"key": "Ocp-Apim-Subscription-Key",
						"value": "{{Ocp-Apim-Subscription-Key-Access-Token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{base_url}}/accessToken/get",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"accessToken",
						"get"
					]
				}
			},
			"response": []
		},
		{
			"name": "Initiate a PSP Payment",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "3d3fadce-ac2c-446e-9050-e609e35499d0",
						"exec": [
							"function makeId() {",
							"  var id = \"\";",
							"  var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";",
							"  for (var i = 0; i < 12; i++)",
							"    id += possible.charAt(Math.floor(Math.random() * possible.length));",
							"  return id;",
							"}",
							"pm.environment.set('pspTransactionId', makeId());",
							"pm.environment.set('merchantOrderId', makeId());",
							"pm.environment.set('makePaymentToken', makeId());"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					},
					{
						"key": "Ocp-Apim-Subscription-Key",
						"value": "{{Ocp-Apim-Subscription-Key-PSP}}"
					},
					{
						"key": "PSP-ID",
						"value": "{{PSP-ID}}"
					},
					{
						"key": "MERCHANT-SERIAL-NUMBER",
						"value": "{{MERCHANT-SERIAL-NUMBER}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"pspTransactionId\": \"{{pspTransactionId}}\",\n  \"merchantOrderId\": \"{{merchantOrderId}}\",\n  \"customerMobileNumber\": \"{{customerMobileNumber}}\",\n  \"amount\": \"{{amount}}\",\n  \"currency\": \"NOK\",\n  \"pspRedirectUrl\": \"{{pspRedirectUrl}}\",\n  \"makePaymentUrl\": \"{{makePaymentUrl}}\",\n  \"makePaymentToken\": \"{{makePaymentToken}}\",\n  \"paymentText\": \"{{paymentTextInit}}\",\n  \"isApp\": false\n}"
				},
				"url": {
					"raw": "{{base_url}}/psp/v2/psppayments/init",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"psp",
						"v2",
						"psppayments",
						"init"
					]
				}
			},
			"response": []
		},
		{
			"name": "Update Status",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					},
					{
						"key": "MERCHANT-SERIAL-NUMBER",
						"value": "{{MERCHANT-SERIAL-NUMBER}}"
					},
					{
						"key": "Ocp-Apim-Subscription-Key",
						"value": "{{Ocp-Apim-Subscription-Key-PSP}}"
					},
					{
						"key": "PSP-ID",
						"value": "{{PSP-ID}}"
					},
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"transactions\": [\n\t{\n\t  \"pspTransactionId\": \"{{pspTransactionId}}\",\n\t  \"status\": \"{{status}}\",\n\t  \"amount\": \"{{amount}}\",\n\t  \"currency\": \"NOK\",\n\t  \"paymentText\": \"{{paymentTextUpdate}}\"\n\t}\n  ]\n}"
				},
				"url": {
					"raw": "{{base_url}}/psp/v2/psppayments/updateStatus",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"psp",
						"v2",
						"psppayments",
						"updateStatus"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get Details",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					},
					{
						"key": "MERCHANT-SERIAL-NUMBER",
						"value": "{{MERCHANT-SERIAL-NUMBER}}"
					},
					{
						"key": "Ocp-Apim-Subscription-Key",
						"value": "{{Ocp-Apim-Subscription-Key-PSP}}"
					},
					{
						"key": "PSP-ID",
						"value": "{{PSP-ID}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/psp/v2/psppayments/{{pspTransactionId}}/details",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"psp",
						"v2",
						"psppayments",
						"{{pspTransactionId}}",
						"details"
					]
				}
			},
			"response": []
		}
	]
}